<!-- 
 This page is optimized for Asus Zenfone 2, in kiosk mode, landscape.
-->
<!DOCTYPE html>
<html>
<head>
    <meta name="screen-orientation" content="landscape">
    <style type="text/css">
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        body {
            font-family: Arial, sans-serif;
            background: #222;
            color: #eee;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }
        .container {
            width: 96%;
            max-width: 540px;
            margin: 0 auto;
            padding: 24px 4px 4px 4px;
            box-sizing: border-box;
        }
        h2 {
            font-size: 2.2em;
            margin: 0 0 20px 0;
            text-align: center;
            word-break: break-word;
        }
        .data {
            margin-bottom: 2px;
            padding: 8px;
            background: rgba(51,51,51,0.7);
            border-radius: 8px;
        }
        .label {
            display: inline-block;
            width: 110px;
            white-space: nowrap;
        }
        .hostname-value {
            color: #00eaff;
            font-weight: bold;
            text-shadow: 0 0 6px #00eaff, 0 0 2px #222;
            letter-spacing: 1px;
            font-size: 1.1em;
        }
        @keyframes hostname-glow {
    /* ...rimosso: animazione glow... */
        }
        .load-value {
            display: inline-block;
            min-width: 60px;
            text-align: right;
        }
        .main-row {
            width: 100vw;
            min-height: 100vh;
            overflow: hidden;
        }
        .date-time-hour {
            font-size: 2.2em;
            font-weight: bold;
            letter-spacing: 2px;
            color: #fff;
        }
        .date-time-day {
            font-size: 1.1em;
            color: #eee;
            opacity: 0.8;
        }
        .left-section {
            float: left;
            width: 50%;
            box-sizing: border-box;
        }
        .right-section {
            float: left;
            width: 50%;
            box-sizing: border-box;
        }
        @media screen and (max-width: 900px) {
            .left-section, .right-section {
                float: none;
                width: 100%;
            }
        }
        @media screen and (orientation: landscape) {
            .container {
                max-width: 900px;
            }
        }
    </style>
    <meta charset="UTF-8">
    <title>Phoenix System Monitor</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type="text/css">
        body {
            font-family: Arial, sans-serif;
            background: #000;
            color: #eee;
            margin: 0;
            padding: 0;
        }
    /* ...existing code... */
    </style>
</head>
<body>
    <div id="bg-gif" style="position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);z-index:0;pointer-events:none;">
    <img src="images/hal9000.gif" alt="HAL 9000" style="border-radius:50%; width:90%; height:90%;" />
    </div>
    <div style="position:relative;z-index:1;">
        <table style="width:100%; border-collapse:collapse; table-layout:fixed;">
            <tr>
                <td style="vertical-align:top; width:50%;">
                    <div class="container" >
                        <div class="data" style="margin-top:5px;">
                            <span class="label">Hostname:</span> <span class="hostname-value" id="hostname">...</span><br>
                            <span class="label">IP:</span> <span id="ip">...</span><br>
                            <span class="label">OS:</span> <span id="os">...</span><br>
                            <span class="label">Uptime:</span> <span id="uptime">...</span>
                        </div>
                        <div class="data" style="margin-top:2px;">
                            <span class="label">CPU:</span>
                            <span id="cpu">...</span>%
                            <canvas id="cpuPie" width="40" height="40" style="vertical-align: middle;"></canvas>
                            <br />
                            <span class="label">Temp:</span>
                            <span id="cpu_temp">...</span> Â°C
                        </div>
                        <div class="data" style="margin-top:2px;">
                            <span class="label">RAM:</span>
                            <span id="ram">...</span>%
                            <canvas id="ramPie" width="40" height="40" style="vertical-align: middle;"></canvas>
                        </div>
                        <div class="data" style="margin-top:2px;">
                            <span class="label">Disk:</span>
                            <span id="disk">...</span>%
                            <canvas id="diskPie" width="40" height="40" style="vertical-align: middle;"></canvas>
                        </div>
                    </div>
                </td>
                <td style="vertical-align:top; width:50%;">
                    <div class="container">
                        <div class="data" style="margin-top:5px;">
                            <span class="label">Net Sent:</span>
                            <span id="net_sent">...</span> MB/s
                            <div style="width:100%;height:18px;background:#444;border-radius:6px;margin-top:6px;">
                                <div id="net_sent_bar" style="height:18px;width:0;background:#4caf50;border-radius:6px;"></div>
                            </div>
                            <br>
                            <span class="label" style="margin-top:5px;">Net Recv:</span>
                            <span id="net_recv">...</span> MB/s
                            <div style="width:100%;height:18px;background:#444;border-radius:6px;margin-top:6px;">
                                <div id="net_recv_bar" style="height:18px;width:0;background:#4caf50;border-radius:6px;"></div>
                            </div>
                        </div>
                        <div class="data" style="margin-top:2px;">
                            <span class="label">Load Avg (1m):</span> <span class="load-value" id="load1">...</span><br>
                            <span class="label">Load Avg (5m):</span> <span class="load-value" id="load5">...</span><br>
                            <span class="label">Load Avg (15m):</span> <span class="load-value" id="load15">...</span>
                        </div>
                        <div class="data" style="margin-top:2px; text-align:center;">
                            <span id="datetime">...</span><br>
                        </div>
                    </div>
                </td>
            </tr>
        </table>
    </div>
    <!-- CSS spostato nel <head> -->
    <script type="text/javascript">
        function pad(n) {
            return n < 10 ? '0' + n : n;
        }
        function updateDateTime() {
            var now = new Date();
            var day = pad(now.getDate());
            var month = pad(now.getMonth() + 1);
            var year = now.getFullYear();
            var hours = pad(now.getHours());
            var minutes = pad(now.getMinutes());
            var seconds = pad(now.getSeconds());
            var dateStr = day + '/' + month + '/' + year;
            var timeStr = hours + ':' + minutes + ':' + seconds;
            var el = document.getElementById('datetime');
            if (el) el.innerHTML = '<span class="date-time-hour">' + timeStr + '</span><br><span class="date-time-day">' + dateStr + '</span>';
        }
        setInterval(updateDateTime, 1000);
        window.onload = function() {
            fetchStatus();
            updateDateTime();
        };
        function drawDiskPie(percent) {
            var canvas = document.getElementById('diskPie');
            if (!canvas) return;
            var ctx = canvas.getContext('2d');
            var w = canvas.width;
            var h = canvas.height;
            ctx.clearRect(0, 0, w, h);
            var angle = Math.PI * 2 * (percent / 100);
            // Colore dinamico
            var color = '#4caf50'; // verde
            if (percent >= 80) {
                color = '#f44336'; // rosso
            } else if (percent >= 70) {
                color = '#ffeb3b'; // giallo
            }
            // Draw background (free disk)
            ctx.beginPath();
            ctx.moveTo(w/2, h/2);
            ctx.arc(w/2, h/2, w/2-2, 0, Math.PI*2, false);
            ctx.closePath();
            ctx.fillStyle = '#444';
            ctx.fill();
            // Draw used disk
            ctx.beginPath();
            ctx.moveTo(w/2, h/2);
            ctx.arc(w/2, h/2, w/2-2, -Math.PI/2, -Math.PI/2 + angle, false);
            ctx.closePath();
            ctx.fillStyle = color;
            ctx.fill();
        }
        function drawRamPie(percent) {
            var canvas = document.getElementById('ramPie');
            if (!canvas) return;
            var ctx = canvas.getContext('2d');
            var w = canvas.width;
            var h = canvas.height;
            ctx.clearRect(0, 0, w, h);
            var angle = Math.PI * 2 * (percent / 100);
            // Colore dinamico
            var color = '#4caf50'; // verde
            if (percent >= 80) {
                color = '#f44336'; // rosso
            } else if (percent >= 50) {
                color = '#ffeb3b'; // giallo
            }
            // Draw background (free RAM)
            ctx.beginPath();
            ctx.moveTo(w/2, h/2);
            ctx.arc(w/2, h/2, w/2-2, 0, Math.PI*2, false);
            ctx.closePath();
            ctx.fillStyle = '#444';
            ctx.fill();
            // Draw used RAM
            ctx.beginPath();
            ctx.moveTo(w/2, h/2);
            ctx.arc(w/2, h/2, w/2-2, -Math.PI/2, -Math.PI/2 + angle, false);
            ctx.closePath();
            ctx.fillStyle = color;
            ctx.fill();
        }
        var lastNetSent = null;
        var lastNetRecv = null;
        var lastTime = null;
        function drawCpuPie(percent) {
            var canvas = document.getElementById('cpuPie');
            if (!canvas) return;
            var ctx = canvas.getContext('2d');
            var w = canvas.width;
            var h = canvas.height;
            ctx.clearRect(0, 0, w, h);
            var angle = Math.PI * 2 * (percent / 100);
            // Colore dinamico
            var color = '#4caf50'; // verde
            if (percent >= 80) {
                color = '#f44336'; // rosso
            } else if (percent >= 50) {
                color = '#ffeb3b'; // giallo
            }
            // Draw background (free CPU)
            ctx.beginPath();
            ctx.moveTo(w/2, h/2);
            ctx.arc(w/2, h/2, w/2-2, 0, Math.PI*2, false);
            ctx.closePath();
            ctx.fillStyle = '#444';
            ctx.fill();
            // Draw used CPU
            ctx.beginPath();
            ctx.moveTo(w/2, h/2);
            ctx.arc(w/2, h/2, w/2-2, -Math.PI/2, -Math.PI/2 + angle, false);
            ctx.closePath();
            ctx.fillStyle = color;
            ctx.fill();
        }

        function fetchStatus() {
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        var data = JSON.parse(xhr.responseText);
                        // Helper per mostrare N/A se il valore non Ã¨ valido
                        function showValue(val, digits) {
                            if (val === null || val === undefined || isNaN(val)) return 'N/A';
                            if (typeof digits === 'number') return Number(val).toFixed(digits);
                            return val;
                        }
                        document.getElementById('hostname').innerHTML = data.hostname ? data.hostname : 'N/A';
                        document.getElementById('ip').innerHTML = data.ip ? data.ip : 'N/A';
                        document.getElementById('os').innerHTML = data.os ? data.os : 'N/A';
                        document.getElementById('cpu').innerHTML = showValue(data.cpu_percent, 1);
                        drawCpuPie(!isNaN(data.cpu_percent) ? data.cpu_percent : 0);
                        var cpuTempEl = document.getElementById('cpu_temp');
                        if (cpuTempEl) {
                            cpuTempEl.innerHTML = showValue(data.cpu_temp, 1);
                            if (data.cpu_temp_alarm) {
                                cpuTempEl.style.color = '#f44336';
                                cpuTempEl.innerHTML += ' (ALERT)';
                            } else {
                                cpuTempEl.style.color = '';
                            }
                        }
                        document.getElementById('ram').innerHTML = showValue(data.ram_percent, 1);
                        drawRamPie(!isNaN(data.ram_percent) ? data.ram_percent : 0);
                        document.getElementById('disk').innerHTML = showValue(data.disk_percent, 1);
                        drawDiskPie(!isNaN(data.disk_percent) ? data.disk_percent : 0);
                        // Load average color logic
                        function colorizeLoad(val) {
                            if (val === null || val === undefined || isNaN(val)) return '';
                            if (val >= 4) return '#f44336'; // rosso
                            if (val >= 2) return '#ffeb3b'; // giallo
                            return '#4caf50'; // verde
                        }
                        var load1El = document.getElementById('load1');
                        var load5El = document.getElementById('load5');
                        var load15El = document.getElementById('load15');
                        var load1Val = showValue(data.load_avg_1m, 3);
                        var load5Val = showValue(data.load_avg_5m, 3);
                        var load15Val = showValue(data.load_avg_15m, 3);
                        if (load1El) {
                            load1El.innerHTML = load1Val;
                            load1El.style.color = colorizeLoad(Number(data.load_avg_1m));
                        }
                        if (load5El) {
                            load5El.innerHTML = load5Val;
                            load5El.style.color = colorizeLoad(Number(data.load_avg_5m));
                        }
                        if (load15El) {
                            load15El.innerHTML = load15Val;
                            load15El.style.color = colorizeLoad(Number(data.load_avg_15m));
                        }
                        document.getElementById('uptime').innerHTML = (data.uptime_seconds === null || data.uptime_seconds === undefined || isNaN(data.uptime_seconds)) ? 'N/A' : formatUptime(data.uptime_seconds);

                        var now = new Date().getTime() / 1000;
                        var netSentMBs = 'N/A';
                        var netRecvMBs = 'N/A';
                        if (lastNetSent !== null && lastNetRecv !== null && lastTime !== null && !isNaN(data.net_sent) && !isNaN(data.net_recv)) {
                            var deltaSent = data.net_sent - lastNetSent;
                            var deltaRecv = data.net_recv - lastNetRecv;
                            var deltaTime = now - lastTime;
                            if (deltaTime > 0) {
                                netSentMBs = (!isNaN(deltaSent) && !isNaN(deltaTime)) ? (deltaSent / 1048576 / deltaTime).toFixed(2) : 'N/A';
                                netRecvMBs = (!isNaN(deltaRecv) && !isNaN(deltaTime)) ? (deltaRecv / 1048576 / deltaTime).toFixed(2) : 'N/A';
                            }
                        }
                        lastNetSent = !isNaN(data.net_sent) ? data.net_sent : null;
                        lastNetRecv = !isNaN(data.net_recv) ? data.net_recv : null;
                        lastTime = now;
                        document.getElementById('net_sent').innerHTML = netSentMBs;
                        document.getElementById('net_recv').innerHTML = netRecvMBs;
                        // Aggiorna barre
                        // Nuove soglie per fibra: maxNet = 78 MB/s (622.2 Mbps)
                        var maxNet = 78; // MB/s
                        var sentPerc = (!isNaN(netSentMBs) ? Math.min(netSentMBs / maxNet, 1) * 100 : 0);
                        var recvPerc = (!isNaN(netRecvMBs) ? Math.min(netRecvMBs / maxNet, 1) * 100 : 0);
                        var sentColor = '#4caf50';
                        var recvColor = '#4caf50';
                        // Soglie: giallo sopra 40 MB/s, rosso sopra 60 MB/s
                        if (!isNaN(netSentMBs) && netSentMBs >= 60) sentColor = '#f44336';
                        else if (!isNaN(netSentMBs) && netSentMBs >= 40) sentColor = '#ffeb3b';
                        if (!isNaN(netRecvMBs) && netRecvMBs >= 60) recvColor = '#f44336';
                        else if (!isNaN(netRecvMBs) && netRecvMBs >= 40) recvColor = '#ffeb3b';
                        var sentBar = document.getElementById('net_sent_bar');
                        var recvBar = document.getElementById('net_recv_bar');
                        if (sentBar) {
                            sentBar.style.width = sentPerc + '%';
                            sentBar.style.background = sentColor;
                        }
                        if (recvBar) {
                            recvBar.style.width = recvPerc + '%';
                            recvBar.style.background = recvColor;
                        }
                    } else {
                        // Errore: imposta tutti i campi a N/A
                        document.getElementById('cpu').innerHTML = 'N/A';
                        drawCpuPie(0);
                        var cpuTempEl = document.getElementById('cpu_temp');
                        if (cpuTempEl) {
                            cpuTempEl.innerHTML = 'N/A';
                            cpuTempEl.style.color = '';
                        }
                        document.getElementById('ram').innerHTML = 'N/A';
                        drawRamPie(0);
                        document.getElementById('disk').innerHTML = 'N/A';
                        drawDiskPie(0);
                        document.getElementById('load1').innerHTML = 'N/A';
                        document.getElementById('uptime').innerHTML = 'N/A';
                        document.getElementById('net_sent').innerHTML = 'N/A';
                        document.getElementById('net_recv').innerHTML = 'N/A';
                        var sentBar = document.getElementById('net_sent_bar');
                        var recvBar = document.getElementById('net_recv_bar');
                        if (sentBar) {
                            sentBar.style.width = '0%';
                            sentBar.style.background = '#4caf50';
                        }
                        if (recvBar) {
                            recvBar.style.width = '0%';
                            recvBar.style.background = '#4caf50';
                        }
                    }
                }
            };
            xhr.open('GET', '/api/status', true);
            xhr.send();
        }
        function formatUptime(seconds) {
            if (!seconds) return 'N/A';
            var days = Math.floor(seconds / 86400);
            var h = Math.floor((seconds % 86400) / 3600);
            var m = Math.floor((seconds % 3600) / 60);
            var s = seconds % 60;
            var str = '';
            if (days > 0) str += days + 'g ';
            str += h + 'h ' + m + 'm ' + s + 's';
            return str;
        }
        setInterval(fetchStatus, 3000);
        window.onload = fetchStatus;
    </script>
</body>
</html>
